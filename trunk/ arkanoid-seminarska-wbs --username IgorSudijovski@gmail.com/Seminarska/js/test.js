var CURSOR = "/9j/4AAQSkZJRgABAQEAYABgAAD/4RBmRXhpZgAATU0AKgAAAAgAAwESAAMAAAABAAEAAIdpAAQAAAABAAAIPuocAAcAAAgMAAAAMgAAAAAc6gAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB6hwABwAACAwAAAhQAAAAABzqAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD/4QjdaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49J++7vycgaWQ9J1c1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCc/Pg0KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyI+PHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIi8+PC94OnhtcG1ldGE+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDw/eHBhY2tldCBlbmQ9J3cnPz7/2wBDAAIBAQIBAQICAgICAgICAwUDAwMDAwYEBAMFBwYHBwcGBwcICQsJCAgKCAcHCg0KCgsMDAwMBwkODw0MDgsMDAz/2wBDAQICAgMDAwYDAwYMCAcIDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAz/wAARCAABAAEDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPExcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwD8c6KKKAP/2Q==";
var player;
var canvas;
var con;
var map;
var timer;
var curr = 0;
var counter;
var readytimer;
var mapp = null;
var readycount = 3;
var pauseFlag = true;
var start = true;
var sound = true;
var mute;
var level;
var host = 'http://localhost/Arkanoid/';
function count() {
    var days_i = "000" + curr;
    curr++;
    change("minutesup", days_i.charAt(days_i.length - 1), 10);
    change("minutesdown", days_i.charAt(days_i.length - 1), 50);
    change("seconds2up", days_i.charAt(days_i.length - 2), 10);
    change("seconds2down", days_i.charAt(days_i.length - 2), 100);
    change("seconds1up", days_i.charAt(days_i.length - 3), 10);
    change("seconds1down", days_i.charAt(days_i.length - 3), 150);
    if (days_i.charAt(days_i.length - 2) == '5' && days_i.charAt(days_i.length - 1) == '9') {
        curr += 40;
    }

    counter = setTimeout(count, 1000);
}

function countEnd() {
    days_i = "000" + curr;
    change("minutesup", days_i.charAt(days_i.length - 1), 10);
    change("minutesdown", days_i.charAt(days_i.length - 1), 50);
    change("seconds2up", days_i.charAt(days_i.length - 2), 10);
    change("seconds2down", days_i.charAt(days_i.length - 2), 100);
    change("seconds1up", days_i.charAt(days_i.length - 3), 10);
    change("seconds1down", days_i.charAt(days_i.length - 3), 150);
    if (curr == player.endTime) {
        clearTimeout(counter);
        player.showGameOver(con);
        return;
    }
        
    if (days_i.charAt(days_i.length - 2) == '5' && days_i.charAt(days_i.length - 1) == '9') {
        curr += 40;
    }
    curr++;
    player.points += 5;
    player.update();
    counter = setTimeout(countEnd, 1);
}

function change(h, val, delay) {
    setTimeout(function () {
        document.getElementById(h).innerText = val;
    }, delay);
}
function onMute(e) {
    if (sound) {
        mute.value = "unmute";
        mute.style.background = "#FF0000";
        sound = false;
    } else {
        mute.value = "mute";
        mute.style.background = "#000000";
        sound = true;
    }
}
function init() {

    mute = document.getElementById("mute");
    mute.onclick = onMute;
    if (!sound)
        mute.style.background = "#FF0000";
    else
        mute.style.background = "#000000";
    readycount = 3;
    snd = sessionStorage.getItem("mute");
    if (snd == "true")
        sound = true;
    if (snd == "false")
        sound = false;
    onMute("null");
    curr = 0;
    canvas = document.getElementById('myCanvas');
    con = canvas.getContext('2d');
    var odocanvas = document.getElementById('score');
    odocon = odocanvas.getContext('2d');
    canvas.height = screen.height;
    canvas.width = screen.width - 300;
    var prepair = sessionStorage.getItem("player");
    player = new Player();
    var textmap = prepair.split("!!");
    var textpoints = textmap[0].split(";");
    var mapp = [];
    for (var i = 0; i < textpoints.length; i++) {
        var tmp = textpoints[i].split(",");
        mapp.push([parseInt(tmp[0]), parseInt(tmp[1]), parseInt(tmp[2])]);
    }
    var mapforPlayer = new Map();
    mapforPlayer.init(canvas.width, mapp);
    mapforPlayer.color = textmap[2].split(",");
    player.map = mapforPlayer;
    var ball = new Ball();
    ball.init(true);
    ball.color = textmap[1];
    player.balls.push(ball);
    player.multiple.push(1);
    player.name = textmap[3];
    var base = new Base();
    base.color = textmap[4];
    player.base = base;
    start = true;
    if (textmap[5] == "easy") {
        level = 0;
        easy();
    } else if (textmap[5] == "medium") {
        medium();
        level = 0;
    } else if (textmap[5] == "hard") {
        hard();
        level = 0;
    } else {
        veryhard();
        level = 1;
    }
    if (level == 0) {
        document.onmousemove = moveBase;
    } else {
        document.onmousemove = moveBaseForVeryHard;
    }
    pauseFlag = true;
    document.body.onkeydown = pause;
    readytimer = setInterval(ready, 1000);
    player.init(canvas.height, odocon);
    document.getElementById('PlayerName').innerText = player.name;
    document.getElementById('restart').onclick = restart;
    document.getElementById('back').onclick = back;
    document.getElementById("send").style.display = "none";
    document.getElementById("send").onclick = sendScore;

    //ball = new Ball();
    //base = new Base();
    //ball.init();
    //base.y = canvas.height * 0.9;
    //base.x = window.event.clientX;
    //map = new Map();
    //map.init(canvas.width);
    //document.onmousemove = moveBase;
   // timer = setInterval(draw, 10);
}
function draw() {
    con.clearRect(0, 0, canvas.width, canvas.height);
    player.checkBallsTouchBase();
    player.moveBalls();
    player.drawBalls(con);
    player.base.drawBase(con);
    player.ballsTouchWalls(canvas.height, canvas.width);
    player.ballsTouchElements();
    player.map.draw(con);
    player.gameOver(con,counter,curr);
}

function moveBase(e) {
    /*if (e.x > screen.width - 300) {
        document.body.style.cursor = "";
    } else {
        document.body.style.cursor = 'url("data:image/x-icon;base64,' + CURSOR + '"),auto';
    }*/
    con.clearRect(player.base.x, player.base.y - 1, player.base.length, player.base.height + 2);
    player.moveBase(e.x,canvas.width);
    player.base.drawBase(con);
}

function moveBaseForVeryHard(e){
    /*if (e.x > screen.width - 300) {
        document.body.style.cursor = "";
    } else {
        document.body.style.cursor = 'url("data:image/x-icon;base64,' + CURSOR + '"),auto';
    }*/
    con.clearRect(player.base.x, player.base.y - 1, player.base.length, player.base.height + 2);
    player.moveBase(canvas.width - e.x,canvas.width);
    player.base.drawBase(con);
}

function addBall() {
    player.addBall();
}
function update() {
    player.update();
}
function easy() {
    player.endTime = 959;
    player.base.length = 160;
    player.balls[0].speed = 4;
    player.balls[0].init(true);
}
function medium() {
    player.endTime = 759;
    player.base.length = 140;
    player.balls[0].speed = 6;
    player.balls[0].init(true);
}
function hard() {
    player.endTime = 659;
    player.base.length = 100;
    player.balls[0].speed = 8;
    player.balls[0].init(true);
}
function veryhard() {
    player.endTime = 559;
    player.base.length = 100;
    player.balls[0].speed = 8;
    player.balls[0].init(true);

}
function ready() {
    con.clearRect(0, 0, canvas.width, canvas.height);
    player.drawBalls(con);
    player.base.drawBase(con);
    player.map.draw(con);
    con.font = "bold 80px sans-serif";
    con.fillStyle = "#FF2222";
    con.fillText("Start in " + readycount, 100, (screen.height - 160) / 2);
    readycount--;
    if (readycount == -1) {
        clearInterval(readytimer);
        count();
        player.startdraw();
        start = false;
    }
    
}
function restart() {
    curr = 0;
    player.stopTimer();
    init();
}
function back() {
    sessionStorage.setItem("reload", "false");
    navigate("/pages/Firstpage/default.html");
    //WinJS.Navigation.navigate("/pages/Firstpage/default.html");
    //window.location.href = "/pages/Firstpage/default.html";
}
function pause(e) {
    if (document.onmousemove != null) {
        if (e.key == "Left") moveBaseLeft();
        if (e.key == "Right") moveBaseRight();
    }
    if ((e.key == "Esc" || e.key == "P" || e.key == "p") && pauseFlag && !start) {
        player.stopTimer();
        clearTimeout(counter);
        pauseFlag = false;
        document.body.style.cursor = "";
        document.onmousemove = null;
        con.clearRect(0, 0, canvas.width, canvas.height);
        con.font = "bold 80px sans-serif";
        con.fillStyle = "#2222FF";
        con.fillText("PAUSE ", 100, (screen.height - 160) / 2);
    } else if ((e.key == "Esc" || e.key == "P" || e.key == "p") && !pauseFlag && !start) {
        if (level == 0)
            document.onmousemove = moveBase;
        else
            document.onmousemove = moveBaseForVeryHard;
        player.startdraw();
        count();
        pauseFlag = true;
        draw();
    }    
}
function PlaySound(path) {
    if (sound) {
        var tmp = document.getElementById("sound");
        tmp.src = path;
        tmp.autoplay = true;
    }
}
function sendScore(e) {
    var plyscore = document.getElementById("PlayerName").innerHTML;
    var strply = plyscore.split(" - ");
    var score =  player.points;
    var post = {
        user: strply[0],
        score: score
    }
    WinJS.xhr({
        type: "post",
        url: host + 'updateScore.php',
        data: formatParams(post),
        headers: { "Content-type": "application/x-www-form-urlencoded" },
    });
}
function moveBaseLeft() {
    var x = player.base.x + player.base.length / 2;
    con.clearRect(player.base.x, player.base.y - 1, player.base.length, player.base.height + 2);
    if(level == 0)
        player.moveBase(x - 15, canvas.width);
    else
        player.moveBase(x + 15, canvas.width);
    player.base.drawBase(con);
}
function moveBaseRight() {
    var x = player.base.x + player.base.length / 2;
    con.clearRect(player.base.x, player.base.y - 1, player.base.length, player.base.height + 2);
    if (level == 0)
        player.moveBase(x + 15, canvas.width);
    else
        player.moveBase(x - 15, canvas.width);
    player.base.drawBase(con);
}
function formatParams(p) {
    var queryStr = "";

    for (var propertyName in p) {
        var val = p[propertyName];
        queryStr += propertyName + "=" + encodeURI(val) + "&";
    }

    return queryStr.slice(0, -1);
}